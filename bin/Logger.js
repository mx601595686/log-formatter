"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const isNode = require('is-node');
const chalk = isNode ? require.call(undefined, 'chalk') : undefined; //浏览器不进行样式格式化，同时防止webpack打包时引入chalk
/**
 * 消息模板的构造类
 *
 * @export
 * @class Logger
 */
class Logger extends Function {
    constructor() {
        super();
        /**
         * 日志类型
         */
        this._type = 0 /* log */;
        /**
         * 样式层数组
         */
        this._formatArray = [];
        /**
         * 当前连缀属性所处的位置
         */
        this.sequenceIndex = 0;
        // 第一层默认是当前时间
        this._formatArray.push({
            tag: "time",
            get text() {
                return isNode ? chalk.gray(`[${(new Date).toLocaleTimeString()}]`) : `[${(new Date).toLocaleTimeString()}]`;
            },
            template: []
        }, { template: [], tag: 'first' });
    }
    /**
     * 返回当前层
     */
    get _currentLayer() {
        return this._formatArray[this._formatArray.length - 1];
    }
    /**
     * 创建新的样式层。
     *
     * @private
     * @returns {FormatLayer} 返回新创建的层
     * @memberof Logger
     */
    _newLayer() {
        const layer = { template: [] };
        this._formatArray.push(layer);
        return layer;
    }
    /**
     * 为当前层添加新的样式
     *
     * @private
     * @param {keyof _chalk.ChalkStyleMap} style chalk 样式的名称
     * @memberof Logger
     */
    _addStyle(style) {
        const layer = this._currentLayer;
        if (isNode) {
            layer.style = layer.style === undefined ? chalk[style] : layer.style[style];
        }
    }
    /**
     * 为当前层添加新的样式模板
     *
     * @private
     * @param {(arg: string) => string} template 样式模板
     * @memberof Logger
     */
    _addTemplate(template) {
        const layer = this._currentLayer;
        layer.template.push(template);
    }
    _trigger(property) {
        switch (property) {
            case 'format':
                return this.format.bind(this);
            case 'line':
                return (char = '-', length = 100) => console.log('\r\n', char.repeat(length), '\r\n');
            case 'lineWithText'://双线夹文字
                return (text, char = '-', length = 100) => {
                    let whiteSpace = 0;
                    if (text.length < length) {
                        whiteSpace = (length - text.length) / 2;
                    }
                    console.log('\r\n', char.repeat(length), '\r\n', ' '.repeat(whiteSpace), text, '\r\n', char.repeat(length), '\r\n');
                };
            case 'warn':
                this._type = 1 /* warning */;
                if (this.sequenceIndex === 1) {
                    this.sequenceIndex = 0;
                    this._trigger('yellow');
                }
                else {
                    this._trigger('text');
                    this._trigger('yellow');
                }
                break;
            case 'error':
                this._type = 2 /* error */;
                if (this.sequenceIndex === 1) {
                    this.sequenceIndex = 0;
                    this._trigger('red');
                }
                else {
                    this._trigger('text');
                    this._trigger('red');
                }
                break;
            case 'noTime':
                if (this.sequenceIndex === 1)
                    this.sequenceIndex = 0;
                this._formatArray[0].skip = true;
                break;
            case 'text':
            case 'title':
                if (this.sequenceIndex !== 1)
                    this._newLayer();
                break;
            case 'linefeed':
                this._trigger('text');
                this._currentLayer.text = '\r\n';
                break;
            case 'content':
                this._trigger('linefeed');
                this._trigger('text');
                break;
            case 'square':
                this._addTemplate((arg) => `[${arg}]`);
                break;
            case 'location':
                this._trigger('text');
                this._trigger('square');
                break;
            case 'round':
                this._addTemplate((arg) => `(${arg})`);
                break;
            case 'mustache':
                this._addTemplate((arg) => `{${arg}}`);
                break;
            default://chalk 样式
                this._addStyle(property);
                break;
        }
    }
    format(...text) {
        const result = [];
        for (let i = 0, j = 0; i < text.length; j++) {
            let txt;
            let style;
            let template;
            if (j < this._formatArray.length) {
                if (this._formatArray[j].skip === true)
                    continue;
                txt = this._formatArray[j].text !== undefined ? this._formatArray[j].text : text[i++];
                style = this._formatArray[j].style;
                template = this._formatArray[j].template;
            }
            else {
                txt = text[i++];
                style = this._formatArray[this._formatArray.length - 1].style;
                template = this._formatArray[this._formatArray.length - 1].template;
            }
            switch (Object.prototype.toString.call(txt)) {
                case '[object Error]':
                    txt = txt.message + ' -> ' + txt.stack;
                    break;
                default:
                    if (typeof txt === 'object')
                        txt = JSON.stringify(txt);
                    break;
            }
            if (style !== undefined) {
                txt = style(txt);
            }
            if (template !== undefined) {
                txt = template.reduce((pre, tmp) => tmp(pre), txt);
            }
            result.push(txt);
        }
        return result;
    }
    /**
     * 将格式化后的内容打印到控制台
     *
     * @param {...any[]} text 要被格式化的内容
     * @memberof Logger
     */
    log(...text) {
        switch (this._type) {
            case 0 /* log */:
                console.log(...this.format(...text));
                break;
            case 1 /* warning */:
                console.warn(...this.format(...text));
                break;
            case 2 /* error */:
                console.error(...this.format(...text));
                break;
            default:
                throw new Error('没有对应的日志输出类型：' + this._type);
        }
    }
    /**
     * 包装当前对象
     *
     * @returns {LoggerPublicProperties}
     * @memberof Logger
     */
    toProxy() {
        return new Proxy(this, {
            apply(target, thisArg, argumentsList) {
                target.log(...argumentsList);
            },
            get(target, property, receiver) {
                target.sequenceIndex++;
                const result = target._trigger(property);
                return result === undefined ? receiver : result;
            }
        });
    }
}
exports.Logger = Logger;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LENBQUM7U0FDSixDQUFRLENBQUM7SUFDZCxDQUFDO0NBQ0o7QUF6UEQsd0JBeVBDIiwiZmlsZSI6IkxvZ2dlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIF9jaGFsayBmcm9tICdjaGFsayc7XHJcbmNvbnN0IGlzTm9kZSA9IHJlcXVpcmUoJ2lzLW5vZGUnKTtcclxuY29uc3QgY2hhbGs6IHR5cGVvZiBfY2hhbGsgPSBpc05vZGUgPyByZXF1aXJlLmNhbGwodW5kZWZpbmVkLCAnY2hhbGsnKSA6IHVuZGVmaW5lZDsgIC8v5rWP6KeI5Zmo5LiN6L+b6KGM5qC35byP5qC85byP5YyW77yM5ZCM5pe26Ziy5q2id2VicGFja+aJk+WMheaXtuW8leWFpWNoYWxrXHJcblxyXG5pbXBvcnQgeyBMb2dUeXBlIH0gZnJvbSAnLi9Mb2dUeXBlJztcclxuaW1wb3J0IHsgTG9nZ2VyUHVibGljUHJvcGVydGllcyB9IGZyb20gJy4vTG9nZ2VyUHVibGljUHJvcGVydGllcyc7XHJcbmltcG9ydCB7IEZvcm1hdExheWVyIH0gZnJvbSAnLi9Gb3JtYXRMYXllcic7XHJcblxyXG4vKipcclxuICog5raI5oGv5qih5p2/55qE5p6E6YCg57G7XHJcbiAqIFxyXG4gKiBAZXhwb3J0XHJcbiAqIEBjbGFzcyBMb2dnZXJcclxuICovXHJcbmV4cG9ydCBjbGFzcyBMb2dnZXIgZXh0ZW5kcyBGdW5jdGlvbiB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDml6Xlv5fnsbvlnotcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfdHlwZSA9IExvZ1R5cGUubG9nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC35byP5bGC5pWw57uEICAgIFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9mb3JtYXRBcnJheTogRm9ybWF0TGF5ZXJbXSA9IFtdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmN6L+e57yA5bGe5oCn5omA5aSE55qE5L2N572uXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc2VxdWVuY2VJbmRleCA9IDA7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICAgICAgLy8g56ys5LiA5bGC6buY6K6k5piv5b2T5YmN5pe26Ze0XHJcbiAgICAgICAgdGhpcy5fZm9ybWF0QXJyYXkucHVzaCh7XHJcbiAgICAgICAgICAgIHRhZzogXCJ0aW1lXCIsXHJcbiAgICAgICAgICAgIGdldCB0ZXh0KCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzTm9kZSA/IGNoYWxrLmdyYXkoYFskeyhuZXcgRGF0ZSkudG9Mb2NhbGVUaW1lU3RyaW5nKCl9XWApIDogYFskeyhuZXcgRGF0ZSkudG9Mb2NhbGVUaW1lU3RyaW5nKCl9XWA7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiBbXVxyXG4gICAgICAgIH0sIHsgdGVtcGxhdGU6IFtdLCB0YWc6ICdmaXJzdCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57lvZPliY3lsYJcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXQgX2N1cnJlbnRMYXllcigpOiBGb3JtYXRMYXllciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1hdEFycmF5W3RoaXMuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu65paw55qE5qC35byP5bGC44CCXHJcbiAgICAgKiBcclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKiBAcmV0dXJucyB7Rm9ybWF0TGF5ZXJ9IOi/lOWbnuaWsOWIm+W7uueahOWxglxyXG4gICAgICogQG1lbWJlcm9mIExvZ2dlclxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9uZXdMYXllcigpOiBGb3JtYXRMYXllciB7XHJcbiAgICAgICAgY29uc3QgbGF5ZXIgPSB7IHRlbXBsYXRlOiBbXSB9O1xyXG4gICAgICAgIHRoaXMuX2Zvcm1hdEFycmF5LnB1c2gobGF5ZXIpO1xyXG4gICAgICAgIHJldHVybiBsYXllcjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS4uuW9k+WJjeWxgua3u+WKoOaWsOeahOagt+W8j1xyXG4gICAgICogXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQHBhcmFtIHtrZXlvZiBfY2hhbGsuQ2hhbGtTdHlsZU1hcH0gc3R5bGUgY2hhbGsg5qC35byP55qE5ZCN56ewXHJcbiAgICAgKiBAbWVtYmVyb2YgTG9nZ2VyXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX2FkZFN0eWxlKHN0eWxlOiBrZXlvZiBfY2hhbGsuQ2hhbGtTdHlsZU1hcCkge1xyXG4gICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5fY3VycmVudExheWVyO1xyXG4gICAgICAgIGlmIChpc05vZGUpIHsgICAvL+a1j+iniOWZqOayoeacieagt+W8j1xyXG4gICAgICAgICAgICBsYXllci5zdHlsZSA9IGxheWVyLnN0eWxlID09PSB1bmRlZmluZWQgPyBjaGFsa1tzdHlsZV0gOiBsYXllci5zdHlsZVtzdHlsZV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Li65b2T5YmN5bGC5re75Yqg5paw55qE5qC35byP5qih5p2/XHJcbiAgICAgKiBcclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKiBAcGFyYW0geyhhcmc6IHN0cmluZykgPT4gc3RyaW5nfSB0ZW1wbGF0ZSDmoLflvI/mqKHmnb9cclxuICAgICAqIEBtZW1iZXJvZiBMb2dnZXJcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfYWRkVGVtcGxhdGUodGVtcGxhdGU6IChhcmc6IHN0cmluZykgPT4gc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLl9jdXJyZW50TGF5ZXI7XHJcbiAgICAgICAgbGF5ZXIudGVtcGxhdGUucHVzaCh0ZW1wbGF0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfdHJpZ2dlcihwcm9wZXJ0eToga2V5b2YgTG9nZ2VyUHVibGljUHJvcGVydGllcyk6IGFueSB7XHJcbiAgICAgICAgc3dpdGNoIChwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICBjYXNlICdmb3JtYXQnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0LmJpbmQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdsaW5lJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiAoY2hhcjogc3RyaW5nID0gJy0nLCBsZW5ndGg6IG51bWJlciA9IDEwMCkgPT4gY29uc29sZS5sb2coJ1xcclxcbicsIGNoYXIucmVwZWF0KGxlbmd0aCksICdcXHJcXG4nKTtcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ2xpbmVXaXRoVGV4dCc6ICAgIC8v5Y+M57q/5aS55paH5a2XXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHRleHQ6IGFueSwgY2hhcjogc3RyaW5nID0gJy0nLCBsZW5ndGg6IG51bWJlciA9IDEwMCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB3aGl0ZVNwYWNlID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGV4dC5sZW5ndGggPCBsZW5ndGgpIHsgICAgLy/lsYXkuK3mmL7npLpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpdGVTcGFjZSA9IChsZW5ndGggLSB0ZXh0Lmxlbmd0aCkgLyAyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1xcclxcbicsIGNoYXIucmVwZWF0KGxlbmd0aCksICdcXHJcXG4nLCAnICcucmVwZWF0KHdoaXRlU3BhY2UpLCB0ZXh0LCAnXFxyXFxuJywgY2hhci5yZXBlYXQobGVuZ3RoKSwgJ1xcclxcbicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY2FzZSAnd2Fybic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90eXBlID0gTG9nVHlwZS53YXJuaW5nO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VxdWVuY2VJbmRleCA9PT0gMSkgeyAvL+WmguaenOS9jeS6juW8gOWktO+8jOWImeS4jea3u+WKoOaWsOWxglxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VxdWVuY2VJbmRleCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigneWVsbG93Jyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoJ3RleHQnKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCd5ZWxsb3cnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnZXJyb3InOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9IExvZ1R5cGUuZXJyb3I7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXF1ZW5jZUluZGV4ID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXF1ZW5jZUluZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCdyZWQnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigndGV4dCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoJ3JlZCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdub1RpbWUnOlxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VxdWVuY2VJbmRleCA9PT0gMSkgLy8g6L+Z5Liq5pS+5Zyo5byA5aS05LiN6K6h5pWwXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXF1ZW5jZUluZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2Zvcm1hdEFycmF5WzBdLnNraXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICd0ZXh0JzpcclxuICAgICAgICAgICAgY2FzZSAndGl0bGUnOlxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VxdWVuY2VJbmRleCAhPT0gMSkgLy/lpoLmnpzkvY3kuo7lvIDlpLTvvIzliJnkvb/nlKhmaXJzdOWxglxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX25ld0xheWVyKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ2xpbmVmZWVkJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoJ3RleHQnKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRMYXllci50ZXh0ID0gJ1xcclxcbic7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ2NvbnRlbnQnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcignbGluZWZlZWQnKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoJ3RleHQnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnc3F1YXJlJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX2FkZFRlbXBsYXRlKChhcmcpID0+IGBbJHthcmd9XWApO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdsb2NhdGlvbic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCd0ZXh0Jyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCdzcXVhcmUnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAncm91bmQnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fYWRkVGVtcGxhdGUoKGFyZykgPT4gYCgke2FyZ30pYCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ211c3RhY2hlJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX2FkZFRlbXBsYXRlKChhcmcpID0+IGB7JHthcmd9fWApO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OiAgICAvL2NoYWxrIOagt+W8j1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYWRkU3R5bGUocHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZvcm1hdCguLi50ZXh0OiBhbnlbXSk6IGFueVtdIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGogPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICBsZXQgdHh0OiBzdHJpbmc7XHJcbiAgICAgICAgICAgIGxldCBzdHlsZTogX2NoYWxrLkNoYWxrQ2hhaW4gfCB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIGxldCB0ZW1wbGF0ZTogKChhcmc6IHN0cmluZykgPT4gc3RyaW5nKVtdO1xyXG5cclxuICAgICAgICAgICAgaWYgKGogPCB0aGlzLl9mb3JtYXRBcnJheS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9mb3JtYXRBcnJheVtqXS5za2lwID09PSB0cnVlKSBjb250aW51ZTtcclxuXHJcbiAgICAgICAgICAgICAgICB0eHQgPSB0aGlzLl9mb3JtYXRBcnJheVtqXS50ZXh0ICE9PSB1bmRlZmluZWQgPyB0aGlzLl9mb3JtYXRBcnJheVtqXS50ZXh0IDogdGV4dFtpKytdO1xyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSB0aGlzLl9mb3JtYXRBcnJheVtqXS5zdHlsZTtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlID0gdGhpcy5fZm9ybWF0QXJyYXlbal0udGVtcGxhdGU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7ICAgLy/liankuIvnmoTlj4LmlbDlhajpg6jkvb/nlKjmnIDlkI7kuIDnp43moLflvI/ov5vooYzmoLzlvI/ljJZcclxuICAgICAgICAgICAgICAgIHR4dCA9IHRleHRbaSsrXTtcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gdGhpcy5fZm9ybWF0QXJyYXlbdGhpcy5fZm9ybWF0QXJyYXkubGVuZ3RoIC0gMV0uc3R5bGU7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZSA9IHRoaXMuX2Zvcm1hdEFycmF5W3RoaXMuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdLnRlbXBsYXRlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0eHQpKSB7ICAvL+WvueeJueWumuexu+Wei+eahOWvueixoei/m+ihjOeJueWumui9rOaNolxyXG4gICAgICAgICAgICAgICAgY2FzZSAnW29iamVjdCBFcnJvcl0nOlxyXG4gICAgICAgICAgICAgICAgICAgIHR4dCA9ICg8YW55PnR4dCkubWVzc2FnZSArICcgLT4gJyArICg8YW55PnR4dCkuc3RhY2s7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHR4dCA9PT0gJ29iamVjdCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR4dCA9IEpTT04uc3RyaW5naWZ5KHR4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChzdHlsZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0eHQgPSBzdHlsZSh0eHQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGVtcGxhdGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdHh0ID0gdGVtcGxhdGUucmVkdWNlKChwcmUsIHRtcCkgPT4gdG1wKHByZSksIHR4dCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHR4dCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bCG5qC85byP5YyW5ZCO55qE5YaF5a655omT5Y2w5Yiw5o6n5Yi25Y+wXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7Li4uYW55W119IHRleHQg6KaB6KKr5qC85byP5YyW55qE5YaF5a65XHJcbiAgICAgKiBAbWVtYmVyb2YgTG9nZ2VyXHJcbiAgICAgKi9cclxuICAgIGxvZyguLi50ZXh0OiBhbnlbXSk6IHZvaWQge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fdHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIExvZ1R5cGUubG9nOlxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coLi4udGhpcy5mb3JtYXQoLi4udGV4dCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIExvZ1R5cGUud2FybmluZzpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybiguLi50aGlzLmZvcm1hdCguLi50ZXh0KSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgTG9nVHlwZS5lcnJvcjpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoLi4udGhpcy5mb3JtYXQoLi4udGV4dCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfmsqHmnInlr7nlupTnmoTml6Xlv5fovpPlh7rnsbvlnovvvJonICsgdGhpcy5fdHlwZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YyF6KOF5b2T5YmN5a+56LGhXHJcbiAgICAgKiBcclxuICAgICAqIEByZXR1cm5zIHtMb2dnZXJQdWJsaWNQcm9wZXJ0aWVzfSBcclxuICAgICAqIEBtZW1iZXJvZiBMb2dnZXJcclxuICAgICAqL1xyXG4gICAgdG9Qcm94eSgpOiBMb2dnZXJQdWJsaWNQcm9wZXJ0aWVzIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb3h5KHRoaXMsIHtcclxuICAgICAgICAgICAgYXBwbHkodGFyZ2V0LCB0aGlzQXJnLCBhcmd1bWVudHNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQubG9nKC4uLmFyZ3VtZW50c0xpc3QpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBnZXQodGFyZ2V0LCBwcm9wZXJ0eToga2V5b2YgTG9nZ2VyUHVibGljUHJvcGVydGllcywgcmVjZWl2ZXIpIHtcclxuICAgICAgICAgICAgICAgIHRhcmdldC5zZXF1ZW5jZUluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0YXJnZXQuX3RyaWdnZXIocHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gcmVjZWl2ZXIgOiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSBhcyBhbnk7XHJcbiAgICB9XHJcbn0iXX0=
