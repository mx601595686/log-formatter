"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const is_in_browser_1 = require("is-in-browser");
const chalk = is_in_browser_1.default ? undefined : require.call(undefined, 'chalk'); //浏览器不进行样式格式化，同时防止webpack打包时引入chalk
/**
 * 消息模板的构造类
 *
 * @export
 * @class Logger
 */
class Logger extends Function {
    constructor() {
        super(...arguments);
        /**
         * 日志类型
         *
         * @private
         * @memberof Logger
         */
        this._type = 0 /* log */;
        /**
         * 文本格式化数组
         *
         * style：定义好样式的chalk方法
         * text：默认的文本。被样式化后传入template进一步处理
         * template：模板
         * tag：内部使用，对这条消息提供一些额外的描述信息
         *
         * @private
         * @memberof Logger
         */
        this._formatArray = [{
                tag: "time",
                get text() {
                    return is_in_browser_1.default ? `[${(new Date).toLocaleTimeString()}]` : chalk.gray(`[${(new Date).toLocaleTimeString()}]`);
                }
            }, { tag: 'first' }];
    }
    format(...text) {
        const result = [];
        for (let i = 0, j = 0; i < text.length; j++) {
            let txt;
            let style;
            let template;
            if (j < this._formatArray.length) {
                txt = this._formatArray[j].text !== undefined ? this._formatArray[j].text : text[i++];
                style = this._formatArray[j].style;
                template = this._formatArray[j].template;
            }
            else {
                txt = text[i++];
                style = this._formatArray[this._formatArray.length - 1].style;
                template = this._formatArray[this._formatArray.length - 1].template;
            }
            if (style !== undefined) {
                txt = style(txt);
            }
            if (template !== undefined) {
                txt = template(txt);
            }
            result.push(txt);
        }
        return result;
    }
    /**
     * 将格式化后的文本打印到控制台
     *
     * @param {...any[]} text 要被格式化的内容
     * @memberof Logger
     */
    log(...text) {
        switch (this._type) {
            case 0 /* log */:
                console.log(...this.format(...text));
                break;
            case 1 /* warning */:
                console.warn(...this.format(...text));
                break;
            case 2 /* error */:
                console.error(...this.format(...text));
                break;
            default:
                throw new Error('没有对应的日志输出类型：' + this._type);
        }
    }
    /**
     * 包装当前对象
     *
     * @returns {LoggerPublicProperties}
     * @memberof Logger
     */
    toProxy() {
        return new Proxy(this, {
            apply(target, thisArg, argumentsList) {
                target.log(...argumentsList);
            },
            get(target, property, receiver) {
                switch (property) {
                    case 'format':
                        return target.format.bind(target);
                    case 'line':
                        return (char = '-', length = 30) => console.log('\r\n', char.repeat(length), '\r\n');
                    case 'warn':
                        target._type = 1 /* warning */;
                        return receiver.yellow;
                    case 'error':
                        target._type = 2 /* error */;
                        return receiver.red;
                    case 'noTime':
                        if (target._formatArray[0].tag === 'time')
                            target._formatArray.shift();
                        return receiver;
                    case 'text':
                    case 'title':
                        if (target._formatArray[target._formatArray.length - 1].tag !== 'first')
                            target._formatArray.push({});
                        else
                            target._formatArray[target._formatArray.length - 1].tag = undefined;
                        return receiver;
                    case 'content':
                        if (target._formatArray[target._formatArray.length - 1].tag !== 'first')
                            target._formatArray.push({ template: (arg) => `\r\n${arg}` });
                        else {
                            target._formatArray[target._formatArray.length - 1].template = (arg) => `\r\n${arg}`;
                            target._formatArray[target._formatArray.length - 1].tag = undefined;
                        }
                        return receiver;
                    case 'linefeed':
                        if (target._formatArray[target._formatArray.length - 1].tag !== 'first')
                            target._formatArray.push({ text: '\r\n' });
                        else {
                            target._formatArray[target._formatArray.length - 1].text = '\r\n';
                            target._formatArray[target._formatArray.length - 1].tag = undefined;
                        }
                        return receiver;
                    case 'square':
                    case 'location':
                        if (target._formatArray[target._formatArray.length - 1].tag !== 'first')
                            target._formatArray.push({ template: (arg) => `[${arg}]` });
                        else {
                            target._formatArray[target._formatArray.length - 1].template = (arg) => `[${arg}]`;
                            target._formatArray[target._formatArray.length - 1].tag = undefined;
                        }
                        return receiver;
                    case 'round':
                        if (target._formatArray[target._formatArray.length - 1].tag !== 'first')
                            target._formatArray.push({ template: (arg) => `(${arg})` });
                        else {
                            target._formatArray[target._formatArray.length - 1].template = (arg) => `(${arg})`;
                            target._formatArray[target._formatArray.length - 1].tag = undefined;
                        }
                        return receiver;
                    case 'mustache':
                        if (target._formatArray[target._formatArray.length - 1].tag !== 'first')
                            target._formatArray.push({ template: (arg) => `{${arg}}` });
                        else {
                            target._formatArray[target._formatArray.length - 1].template = (arg) => `{${arg}}`;
                            target._formatArray[target._formatArray.length - 1].tag = undefined;
                        }
                        return receiver;
                    default://chalk 样式
                        if (!is_in_browser_1.default) {
                            const piece = target._formatArray[target._formatArray.length - 1];
                            piece.style = piece.style === undefined ? chalk[property] : piece.style[property];
                        }
                        return receiver;
                }
            }
        });
    }
}
exports.Logger = Logger;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDLEdBQUcsS0FBSyxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQzt3QkFDaEUsSUFBSSxDQUFDLENBQUM7NEJBQ0YsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxHQUFHLEtBQUssSUFBSSxHQUFHLEdBQUcsQ0FBQzs0QkFDbkYsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsU0FBUyxDQUFDO3dCQUN4RSxDQUFDO3dCQUNELE1BQU0sQ0FBQyxRQUFRLENBQUM7b0JBRXBCLFFBQVksVUFBVTt3QkFDbEIsRUFBRSxDQUFDLENBQUMsQ0FBQyx1QkFBUyxDQUFDLENBQUMsQ0FBQzs0QkFDYixNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDOzRCQUNsRSxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLEtBQUssU0FBUyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUN0RixDQUFDO3dCQUNELE1BQU0sQ0FBQyxRQUFRLENBQUM7Z0JBQ3hCLENBQUM7WUFDTCxDQUFDO1NBQ0osQ0FBUSxDQUFDO0lBQ2QsQ0FBQztDQUNKO0FBckxELHdCQXFMQyIsImZpbGUiOiJMb2dnZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBfY2hhbGsgZnJvbSAnY2hhbGsnO1xyXG5pbXBvcnQgaXNCcm93c2VyIGZyb20gJ2lzLWluLWJyb3dzZXInO1xyXG5jb25zdCBjaGFsazogdHlwZW9mIF9jaGFsayA9IGlzQnJvd3NlciA/IHVuZGVmaW5lZCA6IHJlcXVpcmUuY2FsbCh1bmRlZmluZWQsICdjaGFsaycpOyAgLy/mtY/op4jlmajkuI3ov5vooYzmoLflvI/moLzlvI/ljJbvvIzlkIzml7bpmLLmraJ3ZWJwYWNr5omT5YyF5pe25byV5YWlY2hhbGtcclxuXHJcbmltcG9ydCB7IExvZ1R5cGUgfSBmcm9tICcuL0xvZ1R5cGUnO1xyXG5pbXBvcnQgeyBMb2dnZXJQdWJsaWNQcm9wZXJ0aWVzIH0gZnJvbSAnLi9Mb2dnZXJQdWJsaWNQcm9wZXJ0aWVzJztcclxuXHJcbi8qKlxyXG4gKiDmtojmga/mqKHmnb/nmoTmnoTpgKDnsbtcclxuICogXHJcbiAqIEBleHBvcnRcclxuICogQGNsYXNzIExvZ2dlclxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIExvZ2dlciBleHRlbmRzIEZ1bmN0aW9uIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOaXpeW/l+exu+Wei1xyXG4gICAgICogXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQG1lbWJlcm9mIExvZ2dlclxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF90eXBlID0gTG9nVHlwZS5sb2c7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmlofmnKzmoLzlvI/ljJbmlbDnu4QgICAgXHJcbiAgICAgKiBcclxuICAgICAqIHN0eWxl77ya5a6a5LmJ5aW95qC35byP55qEY2hhbGvmlrnms5UgICAgXHJcbiAgICAgKiB0ZXh077ya6buY6K6k55qE5paH5pys44CC6KKr5qC35byP5YyW5ZCO5Lyg5YWldGVtcGxhdGXov5vkuIDmraXlpITnkIYgICAgXHJcbiAgICAgKiB0ZW1wbGF0Ze+8muaooeadvyAgICBcclxuICAgICAqIHRhZ++8muWGhemDqOS9v+eUqO+8jOWvuei/meadoea2iOaBr+aPkOS+m+S4gOS6m+mineWklueahOaPj+i/sOS/oeaBr1xyXG4gICAgICogXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQG1lbWJlcm9mIExvZ2dlclxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9mb3JtYXRBcnJheTogeyBzdHlsZT86IF9jaGFsay5DaGFsa0NoYWluLCB0ZXh0Pzogc3RyaW5nLCB0ZW1wbGF0ZT86IChhcmc6IHN0cmluZykgPT4gc3RyaW5nLCB0YWc/OiBzdHJpbmcgfVtdID0gW3tcclxuICAgICAgICB0YWc6IFwidGltZVwiLFxyXG4gICAgICAgIGdldCB0ZXh0KCkgeyAgICAvLyDnrKzkuIDkuKrpu5jorqTmmK/miZPljbDml7bpl7RcclxuICAgICAgICAgICAgcmV0dXJuIGlzQnJvd3NlciA/IGBbJHsobmV3IERhdGUpLnRvTG9jYWxlVGltZVN0cmluZygpfV1gIDogY2hhbGsuZ3JheShgWyR7KG5ldyBEYXRlKS50b0xvY2FsZVRpbWVTdHJpbmcoKX1dYCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSwgeyB0YWc6ICdmaXJzdCcgfV07XHJcblxyXG4gICAgZm9ybWF0KC4uLnRleHQ6IGFueVtdKTogYW55W10ge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgaiA9IDA7IGkgPCB0ZXh0Lmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgIGxldCB0eHQ6IHN0cmluZztcclxuICAgICAgICAgICAgbGV0IHN0eWxlOiBfY2hhbGsuQ2hhbGtDaGFpbiB8IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgbGV0IHRlbXBsYXRlOiAoKGFyZzogc3RyaW5nKSA9PiBzdHJpbmcpIHwgdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICAgICAgaWYgKGogPCB0aGlzLl9mb3JtYXRBcnJheS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHR4dCA9IHRoaXMuX2Zvcm1hdEFycmF5W2pdLnRleHQgIT09IHVuZGVmaW5lZCA/IHRoaXMuX2Zvcm1hdEFycmF5W2pdLnRleHQgOiB0ZXh0W2krK107XHJcbiAgICAgICAgICAgICAgICBzdHlsZSA9IHRoaXMuX2Zvcm1hdEFycmF5W2pdLnN0eWxlO1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGUgPSB0aGlzLl9mb3JtYXRBcnJheVtqXS50ZW1wbGF0ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHR4dCA9IHRleHRbaSsrXTtcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gdGhpcy5fZm9ybWF0QXJyYXlbdGhpcy5fZm9ybWF0QXJyYXkubGVuZ3RoIC0gMV0uc3R5bGU7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZSA9IHRoaXMuX2Zvcm1hdEFycmF5W3RoaXMuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdLnRlbXBsYXRlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoc3R5bGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdHh0ID0gc3R5bGUodHh0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRlbXBsYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHR4dCA9IHRlbXBsYXRlKHR4dCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHR4dCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bCG5qC85byP5YyW5ZCO55qE5paH5pys5omT5Y2w5Yiw5o6n5Yi25Y+wXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7Li4uYW55W119IHRleHQg6KaB6KKr5qC85byP5YyW55qE5YaF5a65XHJcbiAgICAgKiBAbWVtYmVyb2YgTG9nZ2VyXHJcbiAgICAgKi9cclxuICAgIGxvZyguLi50ZXh0OiBhbnlbXSk6IHZvaWQge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fdHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIExvZ1R5cGUubG9nOlxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coLi4udGhpcy5mb3JtYXQoLi4udGV4dCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIExvZ1R5cGUud2FybmluZzpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybiguLi50aGlzLmZvcm1hdCguLi50ZXh0KSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgTG9nVHlwZS5lcnJvcjpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoLi4udGhpcy5mb3JtYXQoLi4udGV4dCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfmsqHmnInlr7nlupTnmoTml6Xlv5fovpPlh7rnsbvlnovvvJonICsgdGhpcy5fdHlwZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YyF6KOF5b2T5YmN5a+56LGhXHJcbiAgICAgKiBcclxuICAgICAqIEByZXR1cm5zIHtMb2dnZXJQdWJsaWNQcm9wZXJ0aWVzfSBcclxuICAgICAqIEBtZW1iZXJvZiBMb2dnZXJcclxuICAgICAqL1xyXG4gICAgdG9Qcm94eSgpOiBMb2dnZXJQdWJsaWNQcm9wZXJ0aWVzIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb3h5KHRoaXMsIHtcclxuICAgICAgICAgICAgYXBwbHkodGFyZ2V0LCB0aGlzQXJnLCBhcmd1bWVudHNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQubG9nKC4uLmFyZ3VtZW50c0xpc3QpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBnZXQodGFyZ2V0LCBwcm9wZXJ0eToga2V5b2YgTG9nZ2VyUHVibGljUHJvcGVydGllcywgcmVjZWl2ZXIpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdmb3JtYXQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmZvcm1hdC5iaW5kKHRhcmdldCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2xpbmUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGNoYXI6IHN0cmluZyA9ICctJywgbGVuZ3RoOiBudW1iZXIgPSAzMCkgPT4gY29uc29sZS5sb2coJ1xcclxcbicsIGNoYXIucmVwZWF0KGxlbmd0aCksICdcXHJcXG4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnd2Fybic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5fdHlwZSA9IExvZ1R5cGUud2FybmluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY2VpdmVyLnllbGxvdztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZXJyb3InOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuX3R5cGUgPSBMb2dUeXBlLmVycm9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVjZWl2ZXIucmVkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdub1RpbWUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Ll9mb3JtYXRBcnJheVswXS50YWcgPT09ICd0aW1lJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5fZm9ybWF0QXJyYXkuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY2VpdmVyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd0ZXh0JzpcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd0aXRsZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuX2Zvcm1hdEFycmF5W3RhcmdldC5fZm9ybWF0QXJyYXkubGVuZ3RoIC0gMV0udGFnICE9PSAnZmlyc3QnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Ll9mb3JtYXRBcnJheS5wdXNoKHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Ll9mb3JtYXRBcnJheVt0YXJnZXQuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdLnRhZyA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY2VpdmVyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdjb250ZW50JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC5fZm9ybWF0QXJyYXlbdGFyZ2V0Ll9mb3JtYXRBcnJheS5sZW5ndGggLSAxXS50YWcgIT09ICdmaXJzdCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuX2Zvcm1hdEFycmF5LnB1c2goeyB0ZW1wbGF0ZTogKGFyZykgPT4gYFxcclxcbiR7YXJnfWAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Ll9mb3JtYXRBcnJheVt0YXJnZXQuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdLnRlbXBsYXRlID0gKGFyZykgPT4gYFxcclxcbiR7YXJnfWA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuX2Zvcm1hdEFycmF5W3RhcmdldC5fZm9ybWF0QXJyYXkubGVuZ3RoIC0gMV0udGFnID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbGluZWZlZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Ll9mb3JtYXRBcnJheVt0YXJnZXQuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdLnRhZyAhPT0gJ2ZpcnN0JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5fZm9ybWF0QXJyYXkucHVzaCh7IHRleHQ6ICdcXHJcXG4nIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5fZm9ybWF0QXJyYXlbdGFyZ2V0Ll9mb3JtYXRBcnJheS5sZW5ndGggLSAxXS50ZXh0ID0gJ1xcclxcbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuX2Zvcm1hdEFycmF5W3RhcmdldC5fZm9ybWF0QXJyYXkubGVuZ3RoIC0gMV0udGFnID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3F1YXJlJzpcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdsb2NhdGlvbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuX2Zvcm1hdEFycmF5W3RhcmdldC5fZm9ybWF0QXJyYXkubGVuZ3RoIC0gMV0udGFnICE9PSAnZmlyc3QnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Ll9mb3JtYXRBcnJheS5wdXNoKHsgdGVtcGxhdGU6IChhcmcpID0+IGBbJHthcmd9XWAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Ll9mb3JtYXRBcnJheVt0YXJnZXQuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdLnRlbXBsYXRlID0gKGFyZykgPT4gYFske2FyZ31dYDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5fZm9ybWF0QXJyYXlbdGFyZ2V0Ll9mb3JtYXRBcnJheS5sZW5ndGggLSAxXS50YWcgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY2VpdmVyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdyb3VuZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuX2Zvcm1hdEFycmF5W3RhcmdldC5fZm9ybWF0QXJyYXkubGVuZ3RoIC0gMV0udGFnICE9PSAnZmlyc3QnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Ll9mb3JtYXRBcnJheS5wdXNoKHsgdGVtcGxhdGU6IChhcmcpID0+IGAoJHthcmd9KWAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Ll9mb3JtYXRBcnJheVt0YXJnZXQuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdLnRlbXBsYXRlID0gKGFyZykgPT4gYCgke2FyZ30pYDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5fZm9ybWF0QXJyYXlbdGFyZ2V0Ll9mb3JtYXRBcnJheS5sZW5ndGggLSAxXS50YWcgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY2VpdmVyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdtdXN0YWNoZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuX2Zvcm1hdEFycmF5W3RhcmdldC5fZm9ybWF0QXJyYXkubGVuZ3RoIC0gMV0udGFnICE9PSAnZmlyc3QnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Ll9mb3JtYXRBcnJheS5wdXNoKHsgdGVtcGxhdGU6IChhcmcpID0+IGB7JHthcmd9fWAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Ll9mb3JtYXRBcnJheVt0YXJnZXQuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdLnRlbXBsYXRlID0gKGFyZykgPT4gYHske2FyZ319YDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5fZm9ybWF0QXJyYXlbdGFyZ2V0Ll9mb3JtYXRBcnJheS5sZW5ndGggLSAxXS50YWcgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY2VpdmVyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiAgICAvL2NoYWxrIOagt+W8j1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQnJvd3NlcikgeyAgIC8v5rWP6KeI5Zmo5rKh5pyJ5qC35byPXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwaWVjZSA9IHRhcmdldC5fZm9ybWF0QXJyYXlbdGFyZ2V0Ll9mb3JtYXRBcnJheS5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlLnN0eWxlID0gcGllY2Uuc3R5bGUgPT09IHVuZGVmaW5lZCA/IGNoYWxrW3Byb3BlcnR5XSA6IHBpZWNlLnN0eWxlW3Byb3BlcnR5XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVjZWl2ZXI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSBhcyBhbnk7XHJcbiAgICB9XHJcbn0iXX0=
