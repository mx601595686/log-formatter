"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const is_in_browser_1 = require("is-in-browser");
const chalk = is_in_browser_1.default ? undefined : require.call(undefined, 'chalk'); //浏览器不进行样式格式化，同时防止webpack打包时引入chalk
/**
 * 消息模板的构造类
 *
 * @export
 * @class Logger
 */
class Logger extends Function {
    constructor() {
        super();
        /**
         * 日志类型
         */
        this._type = 0 /* log */;
        /**
         * 样式层数组
         */
        this._formatArray = [];
        /**
         * 当前连缀属性所处的位置
         */
        this.sequenceIndex = 0;
        // 第一层默认是当前时间
        this._formatArray.push({
            tag: "time",
            get text() {
                return is_in_browser_1.default ? `[${(new Date).toLocaleTimeString()}]` : chalk.gray(`[${(new Date).toLocaleTimeString()}]`);
            },
            template: []
        }, { template: [], tag: 'first' });
    }
    /**
     * 返回当前层
     */
    get _currentLayer() {
        return this._formatArray[this._formatArray.length - 1];
    }
    /**
     * 创建新的样式层。
     *
     * @private
     * @returns {FormatLayer} 返回新创建的层
     * @memberof Logger
     */
    _newLayer() {
        const layer = { template: [] };
        this._formatArray.push(layer);
        return layer;
    }
    /**
     * 为当前层添加新的样式
     *
     * @private
     * @param {keyof _chalk.ChalkStyleMap} style chalk 样式的名称
     * @memberof Logger
     */
    _addStyle(style) {
        const layer = this._currentLayer;
        if (!is_in_browser_1.default) {
            layer.style = layer.style === undefined ? chalk[style] : layer.style[style];
        }
    }
    /**
     * 为当前层添加新的样式模板
     *
     * @private
     * @param {(arg: string) => string} template 样式模板
     * @memberof Logger
     */
    _addTemplate(template) {
        const layer = this._currentLayer;
        layer.template.push(template);
    }
    _trigger(property) {
        switch (property) {
            case 'format':
                return this.format.bind(this);
            case 'line':
                return (char = '-', length = 100) => console.log('\r\n', char.repeat(length), '\r\n');
            case 'lineWithText'://双线夹文字
                return (text, char = '-', length = 100) => {
                    let whiteSpace = 0;
                    if (text.length < length) {
                        whiteSpace = (length - text.length) / 2;
                    }
                    console.log('\r\n', char.repeat(length), '\r\n', ' '.repeat(whiteSpace), text, '\r\n', char.repeat(length), '\r\n');
                };
            case 'warn':
                this._type = 1 /* warning */;
                if (this.sequenceIndex === 1) {
                    this.sequenceIndex = 0;
                    this._trigger('yellow');
                }
                else {
                    this._trigger('text');
                    this._trigger('yellow');
                }
                break;
            case 'error':
                this._type = 2 /* error */;
                if (this.sequenceIndex === 1) {
                    this.sequenceIndex = 0;
                    this._trigger('red');
                }
                else {
                    this._trigger('text');
                    this._trigger('red');
                }
                break;
            case 'noTime':
                if (this.sequenceIndex === 1)
                    this.sequenceIndex = 0;
                this._formatArray[0].skip = true;
                break;
            case 'text':
            case 'title':
                if (this.sequenceIndex !== 1)
                    this._newLayer();
                break;
            case 'linefeed':
                this._trigger('text');
                this._currentLayer.text = '\r\n';
                break;
            case 'content':
                this._trigger('linefeed');
                this._trigger('text');
                break;
            case 'square':
                this._addTemplate((arg) => `[${arg}]`);
                break;
            case 'location':
                this._trigger('text');
                this._trigger('square');
                break;
            case 'round':
                this._addTemplate((arg) => `(${arg})`);
                break;
            case 'mustache':
                this._addTemplate((arg) => `{${arg}}`);
                break;
            default://chalk 样式
                this._addStyle(property);
                break;
        }
    }
    format(...text) {
        const result = [];
        for (let i = 0, j = 0; i < text.length; j++) {
            let txt;
            let style;
            let template;
            if (j < this._formatArray.length) {
                if (this._formatArray[j].skip === true)
                    continue;
                txt = this._formatArray[j].text !== undefined ? this._formatArray[j].text : text[i++];
                style = this._formatArray[j].style;
                template = this._formatArray[j].template;
            }
            else {
                txt = text[i++];
                style = this._formatArray[this._formatArray.length - 1].style;
                template = this._formatArray[this._formatArray.length - 1].template;
            }
            switch (Object.prototype.toString.call(txt)) {
                case '[object Error]':
                    txt = txt.message + ' -> ' + txt.stack;
                    break;
                default:
                    if (typeof txt === 'object')
                        txt = JSON.stringify(txt);
                    break;
            }
            if (style !== undefined) {
                txt = style(txt);
            }
            if (template !== undefined) {
                txt = template.reduce((pre, tmp) => tmp(pre), txt);
            }
            result.push(txt);
        }
        return result;
    }
    /**
     * 将格式化后的内容打印到控制台
     *
     * @param {...any[]} text 要被格式化的内容
     * @memberof Logger
     */
    log(...text) {
        switch (this._type) {
            case 0 /* log */:
                console.log(...this.format(...text));
                break;
            case 1 /* warning */:
                console.warn(...this.format(...text));
                break;
            case 2 /* error */:
                console.error(...this.format(...text));
                break;
            default:
                throw new Error('没有对应的日志输出类型：' + this._type);
        }
    }
    /**
     * 包装当前对象
     *
     * @returns {LoggerPublicProperties}
     * @memberof Logger
     */
    toProxy() {
        return new Proxy(this, {
            apply(target, thisArg, argumentsList) {
                target.log(...argumentsList);
            },
            get(target, property, receiver) {
                target.sequenceIndex++;
                const result = target._trigger(property);
                return result === undefined ? receiver : result;
            }
        });
    }
}
exports.Logger = Logger;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LENBQUM7Q0FDSjtBQXpQRCx3QkF5UEMiLCJmaWxlIjoiTG9nZ2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgX2NoYWxrIGZyb20gJ2NoYWxrJztcclxuaW1wb3J0IGlzQnJvd3NlciBmcm9tICdpcy1pbi1icm93c2VyJztcclxuY29uc3QgY2hhbGs6IHR5cGVvZiBfY2hhbGsgPSBpc0Jyb3dzZXIgPyB1bmRlZmluZWQgOiByZXF1aXJlLmNhbGwodW5kZWZpbmVkLCAnY2hhbGsnKTsgIC8v5rWP6KeI5Zmo5LiN6L+b6KGM5qC35byP5qC85byP5YyW77yM5ZCM5pe26Ziy5q2id2VicGFja+aJk+WMheaXtuW8leWFpWNoYWxrXHJcblxyXG5pbXBvcnQgeyBMb2dUeXBlIH0gZnJvbSAnLi9Mb2dUeXBlJztcclxuaW1wb3J0IHsgTG9nZ2VyUHVibGljUHJvcGVydGllcyB9IGZyb20gJy4vTG9nZ2VyUHVibGljUHJvcGVydGllcyc7XHJcbmltcG9ydCB7IEZvcm1hdExheWVyIH0gZnJvbSAnLi9Gb3JtYXRMYXllcic7XHJcblxyXG4vKipcclxuICog5raI5oGv5qih5p2/55qE5p6E6YCg57G7XHJcbiAqIFxyXG4gKiBAZXhwb3J0XHJcbiAqIEBjbGFzcyBMb2dnZXJcclxuICovXHJcbmV4cG9ydCBjbGFzcyBMb2dnZXIgZXh0ZW5kcyBGdW5jdGlvbiB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDml6Xlv5fnsbvlnotcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfdHlwZSA9IExvZ1R5cGUubG9nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC35byP5bGC5pWw57uEICAgIFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9mb3JtYXRBcnJheTogRm9ybWF0TGF5ZXJbXSA9IFtdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmN6L+e57yA5bGe5oCn5omA5aSE55qE5L2N572uXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc2VxdWVuY2VJbmRleCA9IDA7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICAgICAgLy8g56ys5LiA5bGC6buY6K6k5piv5b2T5YmN5pe26Ze0XHJcbiAgICAgICAgdGhpcy5fZm9ybWF0QXJyYXkucHVzaCh7XHJcbiAgICAgICAgICAgIHRhZzogXCJ0aW1lXCIsXHJcbiAgICAgICAgICAgIGdldCB0ZXh0KCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzQnJvd3NlciA/IGBbJHsobmV3IERhdGUpLnRvTG9jYWxlVGltZVN0cmluZygpfV1gIDogY2hhbGsuZ3JheShgWyR7KG5ldyBEYXRlKS50b0xvY2FsZVRpbWVTdHJpbmcoKX1dYCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiBbXVxyXG4gICAgICAgIH0sIHsgdGVtcGxhdGU6IFtdLCB0YWc6ICdmaXJzdCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57lvZPliY3lsYJcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXQgX2N1cnJlbnRMYXllcigpOiBGb3JtYXRMYXllciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1hdEFycmF5W3RoaXMuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu65paw55qE5qC35byP5bGC44CCXHJcbiAgICAgKiBcclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKiBAcmV0dXJucyB7Rm9ybWF0TGF5ZXJ9IOi/lOWbnuaWsOWIm+W7uueahOWxglxyXG4gICAgICogQG1lbWJlcm9mIExvZ2dlclxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9uZXdMYXllcigpOiBGb3JtYXRMYXllciB7XHJcbiAgICAgICAgY29uc3QgbGF5ZXIgPSB7IHRlbXBsYXRlOiBbXSB9O1xyXG4gICAgICAgIHRoaXMuX2Zvcm1hdEFycmF5LnB1c2gobGF5ZXIpO1xyXG4gICAgICAgIHJldHVybiBsYXllcjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS4uuW9k+WJjeWxgua3u+WKoOaWsOeahOagt+W8j1xyXG4gICAgICogXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQHBhcmFtIHtrZXlvZiBfY2hhbGsuQ2hhbGtTdHlsZU1hcH0gc3R5bGUgY2hhbGsg5qC35byP55qE5ZCN56ewXHJcbiAgICAgKiBAbWVtYmVyb2YgTG9nZ2VyXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX2FkZFN0eWxlKHN0eWxlOiBrZXlvZiBfY2hhbGsuQ2hhbGtTdHlsZU1hcCkge1xyXG4gICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5fY3VycmVudExheWVyO1xyXG4gICAgICAgIGlmICghaXNCcm93c2VyKSB7ICAgLy/mtY/op4jlmajmsqHmnInmoLflvI9cclxuICAgICAgICAgICAgbGF5ZXIuc3R5bGUgPSBsYXllci5zdHlsZSA9PT0gdW5kZWZpbmVkID8gY2hhbGtbc3R5bGVdIDogbGF5ZXIuc3R5bGVbc3R5bGVdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS4uuW9k+WJjeWxgua3u+WKoOaWsOeahOagt+W8j+aooeadv1xyXG4gICAgICogXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQHBhcmFtIHsoYXJnOiBzdHJpbmcpID0+IHN0cmluZ30gdGVtcGxhdGUg5qC35byP5qih5p2/XHJcbiAgICAgKiBAbWVtYmVyb2YgTG9nZ2VyXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX2FkZFRlbXBsYXRlKHRlbXBsYXRlOiAoYXJnOiBzdHJpbmcpID0+IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5fY3VycmVudExheWVyO1xyXG4gICAgICAgIGxheWVyLnRlbXBsYXRlLnB1c2godGVtcGxhdGUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3RyaWdnZXIocHJvcGVydHk6IGtleW9mIExvZ2dlclB1YmxpY1Byb3BlcnRpZXMpOiBhbnkge1xyXG4gICAgICAgIHN3aXRjaCAocHJvcGVydHkpIHtcclxuICAgICAgICAgICAgY2FzZSAnZm9ybWF0JzpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdC5iaW5kKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnbGluZSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKGNoYXI6IHN0cmluZyA9ICctJywgbGVuZ3RoOiBudW1iZXIgPSAxMDApID0+IGNvbnNvbGUubG9nKCdcXHJcXG4nLCBjaGFyLnJlcGVhdChsZW5ndGgpLCAnXFxyXFxuJyk7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdsaW5lV2l0aFRleHQnOiAgICAvL+WPjOe6v+WkueaWh+Wtl1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICh0ZXh0OiBhbnksIGNoYXI6IHN0cmluZyA9ICctJywgbGVuZ3RoOiBudW1iZXIgPSAxMDApID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgd2hpdGVTcGFjZSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQubGVuZ3RoIDwgbGVuZ3RoKSB7ICAgIC8v5bGF5Lit5pi+56S6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaXRlU3BhY2UgPSAobGVuZ3RoIC0gdGV4dC5sZW5ndGgpIC8gMjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdcXHJcXG4nLCBjaGFyLnJlcGVhdChsZW5ndGgpLCAnXFxyXFxuJywgJyAnLnJlcGVhdCh3aGl0ZVNwYWNlKSwgdGV4dCwgJ1xcclxcbicsIGNoYXIucmVwZWF0KGxlbmd0aCksICdcXHJcXG4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ3dhcm4nOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9IExvZ1R5cGUud2FybmluZztcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlcXVlbmNlSW5kZXggPT09IDEpIHsgLy/lpoLmnpzkvY3kuo7lvIDlpLTvvIzliJnkuI3mt7vliqDmlrDlsYJcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcXVlbmNlSW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoJ3llbGxvdycpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCd0ZXh0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigneWVsbG93Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ2Vycm9yJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBMb2dUeXBlLmVycm9yO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VxdWVuY2VJbmRleCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VxdWVuY2VJbmRleCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigncmVkJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoJ3RleHQnKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCdyZWQnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnbm9UaW1lJzpcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlcXVlbmNlSW5kZXggPT09IDEpIC8vIOi/meS4quaUvuWcqOW8gOWktOiuoeaVsFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VxdWVuY2VJbmRleCA9IDA7ICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9mb3JtYXRBcnJheVswXS5za2lwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAndGV4dCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3RpdGxlJzpcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlcXVlbmNlSW5kZXggIT09IDEpIC8v5aaC5p6c5L2N5LqO5byA5aS077yM5YiZ5L2/55SoZmlyc3TlsYJcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9uZXdMYXllcigpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdsaW5lZmVlZCc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCd0ZXh0Jyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50TGF5ZXIudGV4dCA9ICdcXHJcXG4nO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdjb250ZW50JzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoJ2xpbmVmZWVkJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCd0ZXh0Jyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ3NxdWFyZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hZGRUZW1wbGF0ZSgoYXJnKSA9PiBgWyR7YXJnfV1gKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnbG9jYXRpb24nOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigndGV4dCcpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcignc3F1YXJlJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ3JvdW5kJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX2FkZFRlbXBsYXRlKChhcmcpID0+IGAoJHthcmd9KWApO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdtdXN0YWNoZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hZGRUZW1wbGF0ZSgoYXJnKSA9PiBgeyR7YXJnfX1gKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDogICAgLy9jaGFsayDmoLflvI9cclxuICAgICAgICAgICAgICAgIHRoaXMuX2FkZFN0eWxlKHByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmb3JtYXQoLi4udGV4dDogYW55W10pOiBhbnlbXSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IHRleHQubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgbGV0IHR4dDogc3RyaW5nO1xyXG4gICAgICAgICAgICBsZXQgc3R5bGU6IF9jaGFsay5DaGFsa0NoYWluIHwgdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICBsZXQgdGVtcGxhdGU6ICgoYXJnOiBzdHJpbmcpID0+IHN0cmluZylbXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChqIDwgdGhpcy5fZm9ybWF0QXJyYXkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZm9ybWF0QXJyYXlbal0uc2tpcCA9PT0gdHJ1ZSkgY29udGludWU7XHJcblxyXG4gICAgICAgICAgICAgICAgdHh0ID0gdGhpcy5fZm9ybWF0QXJyYXlbal0udGV4dCAhPT0gdW5kZWZpbmVkID8gdGhpcy5fZm9ybWF0QXJyYXlbal0udGV4dCA6IHRleHRbaSsrXTtcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gdGhpcy5fZm9ybWF0QXJyYXlbal0uc3R5bGU7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZSA9IHRoaXMuX2Zvcm1hdEFycmF5W2pdLnRlbXBsYXRlO1xyXG4gICAgICAgICAgICB9IGVsc2UgeyAgIC8v5Ymp5LiL55qE5Y+C5pWw5YWo6YOo5L2/55So5pyA5ZCO5LiA56eN5qC35byP6L+b6KGM5qC85byP5YyWXHJcbiAgICAgICAgICAgICAgICB0eHQgPSB0ZXh0W2krK107XHJcbiAgICAgICAgICAgICAgICBzdHlsZSA9IHRoaXMuX2Zvcm1hdEFycmF5W3RoaXMuX2Zvcm1hdEFycmF5Lmxlbmd0aCAtIDFdLnN0eWxlO1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGUgPSB0aGlzLl9mb3JtYXRBcnJheVt0aGlzLl9mb3JtYXRBcnJheS5sZW5ndGggLSAxXS50ZW1wbGF0ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodHh0KSkgeyAgLy/lr7nnibnlrprnsbvlnovnmoTlr7nosaHov5vooYznibnlrprovazmjaJcclxuICAgICAgICAgICAgICAgIGNhc2UgJ1tvYmplY3QgRXJyb3JdJzpcclxuICAgICAgICAgICAgICAgICAgICB0eHQgPSAoPGFueT50eHQpLm1lc3NhZ2UgKyAnIC0+ICcgKyAoPGFueT50eHQpLnN0YWNrO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0eHQgPT09ICdvYmplY3QnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eHQgPSBKU09OLnN0cmluZ2lmeSh0eHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoc3R5bGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdHh0ID0gc3R5bGUodHh0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRlbXBsYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHR4dCA9IHRlbXBsYXRlLnJlZHVjZSgocHJlLCB0bXApID0+IHRtcChwcmUpLCB0eHQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXN1bHQucHVzaCh0eHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhuagvOW8j+WMluWQjueahOWGheWuueaJk+WNsOWIsOaOp+WItuWPsFxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gey4uLmFueVtdfSB0ZXh0IOimgeiiq+agvOW8j+WMlueahOWGheWuuVxyXG4gICAgICogQG1lbWJlcm9mIExvZ2dlclxyXG4gICAgICovXHJcbiAgICBsb2coLi4udGV4dDogYW55W10pOiB2b2lkIHtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuX3R5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBMb2dUeXBlLmxvZzpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKC4uLnRoaXMuZm9ybWF0KC4uLnRleHQpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBMb2dUeXBlLndhcm5pbmc6XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oLi4udGhpcy5mb3JtYXQoLi4udGV4dCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIExvZ1R5cGUuZXJyb3I6XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKC4uLnRoaXMuZm9ybWF0KC4uLnRleHQpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcign5rKh5pyJ5a+55bqU55qE5pel5b+X6L6T5Ye657G75Z6L77yaJyArIHRoaXMuX3R5cGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWMheijheW9k+WJjeWvueixoVxyXG4gICAgICogXHJcbiAgICAgKiBAcmV0dXJucyB7TG9nZ2VyUHVibGljUHJvcGVydGllc30gXHJcbiAgICAgKiBAbWVtYmVyb2YgTG9nZ2VyXHJcbiAgICAgKi9cclxuICAgIHRvUHJveHkoKTogTG9nZ2VyUHVibGljUHJvcGVydGllcyB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh0aGlzLCB7XHJcbiAgICAgICAgICAgIGFwcGx5KHRhcmdldCwgdGhpc0FyZywgYXJndW1lbnRzTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0LmxvZyguLi5hcmd1bWVudHNMaXN0KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZ2V0KHRhcmdldCwgcHJvcGVydHk6IGtleW9mIExvZ2dlclB1YmxpY1Byb3BlcnRpZXMsIHJlY2VpdmVyKSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQuc2VxdWVuY2VJbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGFyZ2V0Ll90cmlnZ2VyKHByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQgPT09IHVuZGVmaW5lZCA/IHJlY2VpdmVyIDogcmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkgYXMgYW55O1xyXG4gICAgfVxyXG59Il19
